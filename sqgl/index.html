<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- Head BEGIN -->

<head>
    <meta charset="utf-8">
    <title>海象</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="Keywords" contect="管理微信群二维码">
    <meta name="Description" contect="生成固定活码">
    <link rel="shortcut icon" href="img/hhb.png">
    <!-- Fonts START -->
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Pathway+Gothic+One|PT+Sans+Narrow:400+700|Source+Sans+Pro:200,300,400,600,700,900&amp;subset=all" rel="stylesheet" type="text/css">
    <!-- Fonts END -->
    <!-- Global styles BEGIN -->
    <link href="../js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link href="../js/bootstrap_table/bootstrap-table.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/sweetalert.css">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/management.css" rel="stylesheet">
    <!-- Theme styles END -->
    <style type="text/css" media="screen">
    .zbt {
        background: #eee;
        height: 45px;
    }

    .zbt div {
        margin: auto;
    }

    .zbt div span {
        line-height: 45px;
    }

    .xzi {
        border-bottom: 2px solid #31a3f2;
        color: #31a3f2;
    }

    .xzpd {
        padding: 12px;
    }

    .xzpd:hover,
    .szbq:hover {
        border-bottom: 2px solid #31a3f2;
        color: #31a3f2;
    }

    .sjsxan {
        padding: 5px 15px;
        background: #eee;
        color: #999;
        border-radius: 6px;
        margin: 0 8px;
    }

    .butxz,
    .sjsxan:hover {
        background: #31A3F2;
        color: #fff;
    }

    .dlms {
        margin: 5px 10px;
        padding: 4px;
        border: 1px solid #31a3f2;
        border-radius: 3px;
        overflow: hidden;
    }

    .dlms img {
        max-width: 100%;
    }

    .dlms p {
        margin: 14px 0 0 0;
        color: #31a3f2;
    }

    .dlms img:hover {
        -webkit-transform: scale(1.2);
        -o-transform: scale(1.2);
    }

    .but {
        position: relative;
        display: flex;
        margin: 20px 0;
        /* height: 40px; */
    }

    .button {
        padding: 5px 15px;
        background: #31A3F2;
        color: #fff;
        border-radius: 6px;
        margin: 0 8px;
    }

    .form-control {
        height: 30px !important;
        height: 100%;
        margin-right: 3%;
        border-radius: 0 !important;
        border-top-left-radius: 2px !important;
        border-bottom-left-radius: 2px !important;
        border: 1px solid #1f91e8;
    }

    .input-group-addon {
        border-radius: 0 4px 4px 0 !important;
        background-color: #1f91e8 !important;
        color: white;
        /* padding: 3px 5px !important; */
        cursor: pointer;
        border: 0px !important;
    }

    .bar {
        border-right: 1px solid #e4e4e4;
    }

    i {
        padding: 0 8px;
        color: #1f91e8;
    }
    </style>
</head>
<!--DOC: menu-always-on-top class to the body element to set menu on top -->

<body class="menu-always-on-top" style="">
    <!-- END BEGIN STYLE CUSTOMIZER -->
    <div class="header" style="">
        <div class="conts containers">
            <h2>授权管理</h2>
            <div class="conts-tit">
                <ul class="header-title" id="nrth"> <a href="./">
                        <li class="hand xs" id="sy">首页</li>
                    </a>
                    <!-- <a href="./management.html">
                        <li class="hand jg fb" id="hm">活码管理</li>
                    </a> <a href="./sys-management.html">
                        <li class="hand jg fb" id="xt">系统管理</li>
                    </a> <a href="./login.html">
                        <li class="hand jg fb" id="dlzc" style="display: none;">登录|注册</li>
                    </a> <a href="./login.html">
                        <li class="hand jg fb yc" id="tcdl" style="display: list-item;">退出</li>
                    </a> -->
                </ul>
            </div>
        </div>
    </div>
    <div class="main" style="margin-top: 160px;">
        <div class="conts containers">
            <!-- 客户面板 -->
            <div class="items khgl">
                <div class="conts contss">
                    <div class="but">
                        <div class="button hand" id="gscj">新建</div>
                        <div class="button hand" id="gssx">刷新</div>
                        <div class="input-group " style="position: absolute;width: 300px;right: 0;">
                            <input id="khlbqk" type="text" class="form-control" placeholder="公司、姓名、手机号">
                            <span id="khcx" class="input-group-addon ">
                                <span class="glyphicon glyphicon-search"></span>
                            </span>
                        </div>
                    </div>
                    <div class="" id="khlb"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="mode dlkl yc">
        <div class="fbq" style="width: 300px; height: 200px;">
            <div class="zpsc_title"><span>口令登录</span></div>
            <div style="margin: 35px 25px; font-size: 16px;">
                <div>
                    <input type="text" name="" class="bbh" id="dlkl" style="margin: 0; width: 100%;" placeholder="请输入口令" />
                </div>
                <div class="fl-right wz">
                    <span style="margin-right: 80px; color: red;font-size: 14px;" id="dlts"></span>
                    <span class="btn kltj">提交</span>
                </div>
            </div>
        </div>
    </div>
    <div class="mode sqbz yc">
        <div class="fbq" style="width: 350px; height: 330px;">
            <div class="zpsc_title"><span>客户修改</span><span class="gbtb glyphicon glyphicon-remove"></span></div>
            <div style="margin: 35px 25px; font-size: 14px;">
                <div class="wz">
                    <span>负责人：</span>
                    <input type="text" class="bbh" id="gsfzr" placeholder="负责人">
                </div>
                <div class="wz">
                    <span>手机号：</span>
                    <input type="text" class="bbh" id="fzrdh" placeholder="电话号码">
                </div>
                <div style="padding-top: 20px;">
                    <textarea id="bz" placeholder="备注" class="wbk"></textarea>
                </div>
                <div class="fl-right wz">
                    <span style="margin-right: 80px; color: red;font-size: 14px;" id="bzts"></span>
                    <span class="btn bztj">提交</span>
                </div>
            </div>
        </div>
    </div>
    <!-- 客户跟进记录 -->
    <div class="mode xfsq yc">
        <div class="fbq" style="width: 400px;height: 230px;">
            <div class="zpsc_title"><span class="zmxjbt">客户跟进记录</span><span class="gbtb glyphicon glyphicon-remove"></span></div>
            <div style="margin: 25px 25px; font-size: 14px;">
                <div class="wz">
                    <span>续费金额：</span>
                    <input type="number" class="bbh" id="jfje" placeholder="金额">
                </div>
                <div class="wz" style="display: inline-flex;">
                    <span>到期时间：</span>
                    <!--指定 date标记-->
                    <div class='input-group date' id='datetimepicker2' style="width: 220px;margin-left: 35px;">
                        <input type='text' class="form-control" id="dqsj" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
                <div class="fl-right wz">
                    <span style="color: red;font-size: 12px;" id="jftx"></span>
                    <!-- <span class="btn btn1 qx">取消</span> -->
                    <span class="btn jftj" data-id="">提交</span>
                </div>
            </div>
        </div>
    </div>
    <!-- 创建公司 -->
    <div class="mode cjgs yc">
        <div class="fbq" style="width: 400px;height: 260px;">
            <div class="zpsc_title"><span class="zmxjbt">创建公司</span><span class="gbtb glyphicon glyphicon-remove"></span></div>
            <div style="margin: 25px 25px; font-size: 14px;">
                <div class="wz">
                    <span>公司简称：</span>
                    <input type="text" class="bbh" id="gsjc" placeholder="公司简称">
                </div>
                <div class="wz">
                    <span>管理员名：</span>
                    <input type="text" class="bbh" id="glyxm" placeholder="管理员姓名">
                </div>
                <div class="wz">
                    <span>电话账号：</span>
                    <input type="text" class="bbh" id="dhh" placeholder="电话号码">
                </div>
                <div class="fl-right wz">
                    <span style="color: red;font-size: 12px;" id="cjtx"></span>
                    <!-- <span class="btn btn1 qx">取消</span> -->
                    <span class="btn cjtj" data-id="">提交</span>
                </div>
            </div>
        </div>
    </div>
    <!-- BEGIN FOOTER -->
    <div class="footer npcxxt" style="text-align: center;bottom: 30px;">
        <div class="conts footer-bq">
            <div style="width: 100%;"> Copyright©2018-2020 <a href="http://www.beian.miit.gov.cn/" target="_blank">渝ICP备19016006号</a></div>
        </div>
    </div>
    <script src="../js/jquery.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap_table/bootstrap-table.js" type="text/javascript"></script>
    <script src="../js/bootstrap_table/bootstrap-table-zh-CN.js" type="text/javascript"></script>
    <script src="../js/moment-with-locales.min.js" type="text/javascript"></script>
    <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
    <script src="../js/sweetalert.min.js"> </script>
    <script type="text/javascript">
    $("#sy").addClass("xs");
    var ym = window.location.protocol + "//" + window.location.host;
    var dz = ym + "/hxhrbmp/";
    //var dz = "http://localhost:8080/";
    klyz()
    $(".kltj").click(function() {
        kldl();
    })
    $("#dlkl").keyup(function(e) {
        if (e.which == 13) {
            kldl();
        }
    });

    function kldl() {
        var kl = $("#dlkl").val();
        if (kl == "") {
            $("#dlts").text("口令不能为空！");
        } else {
            $.ajax({
                url: dz + "authentication",
                method: "POST",
                data: {
                    kl: kl
                },
                cache: false,
                async: false,
                success: function(data) {
                    if (data.yz == 1) {
                        $(".dlkl").hide();
                        sessionStorage.setItem('kl', kl);
                        window.location.reload();
                    } else {
                        $("#dlts").text("口令错误！");
                    }
                },
                error: function(data) {
                    $("#dlts").text("请重新尝试！");
                }
            });
        }
    }
    khzs();

    function klyz() {
        var kl = sessionStorage.getItem('kl');
        if (kl == null || kl == "" || kl == undefined) {
            $(".dlkl").show();
            // $("#dlkl").focus();
            setTimeout(function() {
                $("#dlkl").focus();
            }, 50)
        }
    }

    function gb() {
        $(".mode").hide();
        $("#bzts,#jftx").text("")
        $("textarea,input").val("")
    }

    $('#datetimepicker2').datetimepicker({
        format: 'YYYY-MM-DD',
        locale: moment.locale('zh-cn')
    });

    // 客户列表
    function khzs(a) {
        if (a == undefined) {
            a = "";
        } else {
            a = '&cx=' + a;
        }
        $('#khlb').empty();
        var str = '<table id="customer"></table>';
        $('#khlb').append(str);
        $('#customer').bootstrapTable({
            url: dz + 'sqList?kl=' + sessionStorage.getItem("kl") + a,
            columns: [{
                field: 'id',
                title: 'id',
                valign: 'middle',
                visible: false,
                align: 'center'
            }, {
                field: 'qc',
                title: '公司名称',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'jc',
                title: '公司简称',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'name',
                title: '负责人',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'sjh',
                title: '联系电话',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'jfje',
                title: '续费金额',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'zje',
                title: '总消费',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'dqsj',
                title: '到期时间',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'cjsj',
                title: '创建时间',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'bz',
                title: '备注',
                valign: 'middle',
                align: 'center'
            }, {
                field: 'operator',
                title: '操作',
                align: 'center',
                valign: 'middle',
                width: '140',
                // visible: false,
                formatter: function(value, row, index) {
                    // var sid_code = base64encode(row.sid + '');   //  sid 加密处理
                    // alert(sid_code);
                    return '<a href="javascript:void(0)" data-toggle="modal" title="xg">' +
                        '<i class="bar">修改</i> ' +
                        '<a href="javascript:void(0)" data-toggle="modal" title="xf">' +
                        '<i class="">续费</i> ' +
                        '</a>';
                },
                events: {
                    'click a[title=xg]': function(e, value, row, index) {
                        $(".sqbz").show();
                        $(".bztj").attr("data-id", row.id);
                        $("#gsfzr").val(row.name);
                        $("#fzrdh").val(row.sjh);
                        $("#bz").val(row.bz);
                    },
                    'click a[title=xf]': function(e, value, row, index) {
                        $(".xfsq").show();
                        $(".jftj").attr("data-id", row.id);
                    }
                }
            }],
            pagination: true,
            sidePagination: 'server',
            pageSize: 20,
            pageList: [5, 10, 'all'],
        });
    }

    $(".gbtb").click(function() {
        gb();
    })
    $(".bztj").click(function() {
        var id = $(this).attr("data-id");
        var bz = $("#bz").val();
        var fzr = $("#gsfzr").val();
        var sjh = $("#fzrdh").val();
        // if (bz == "") {
        //     $("#bzts").text("备注不能为空");
        // } else {
            $.ajax({
                type: 'post',
                url: dz + 'upEmp',
                async: false,
                cache: false,
                data: {
                    id: id,
                    bz: bz,
                    fzr: fzr,
                    sjh: sjh
                },
                success: function(data) {
                    if (data.code == 200) {
                        gb();
                        khzs();
                    } else {
                        $("#bzts").text(data.message);
                    }
                },
                error: function(data) {
                    $("#bzts").text("失败，请重新提交");
                }
            });
        // }
    })
    $(".jftj").click(function() {
        var id = $(this).attr("data-id");
        var je = $("#jfje").val();
        var sj = $("#dqsj").val();
        if (je == "" || sj == "") {
            $("#jftx").text("缴费金额和时间不能为空");
        } else {
            $.ajax({
                type: 'post',
                url: dz + 'upPay',
                async: false,
                cache: false,
                data: {
                    id: id,
                    je: je,
                    sj: sj
                },
                success: function(data) {
                    if (data.code == 200) {
                        gb();
                        khzs();
                    } else {
                        $("#jftx").text(data.message);
                    }
                },
                error: function(data) {
                    $("#jftx").text("失败，请重新提交");
                }
            });
        }
    })

    $("#khcx").click(function() {
        var cx = $("#khlbqk").val();
        khzs(cx);
    })

    $("#gssx").click(function() {
        khzs();
    })

    $("#gscj").click(function() {
        $(".cjgs").show();
    })

    $(".cjtj").click(function() {
        var mc = $("#gsjc").val();
        var gly = $("#glyxm").val();
        var dh = $("#dhh").val();
        if (mc == "" || gly == "" || dh == "") {
            $("#cjtx").text("全部不能为空");
        } else {
            $.ajax({
                type: 'post',
                url: dz + 'newCompany',
                async: false,
                cache: false,
                data: {
                    mc: mc,
                    gly: gly,
                    dh: dh
                },
                success: function(data) {
                    if (data.code == 200) {
                        location.reload();
                    } else {
                        $("#cjtx").text(data.message);
                    }
                },
                error: function(data) {
                    $("#cjtx").text("失败，请重新提交");
                }
            });
        }
    })
    </script>
</body>

</html>